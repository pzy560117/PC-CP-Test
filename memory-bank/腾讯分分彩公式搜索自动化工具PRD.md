# 腾讯分分彩公式搜索自动化工具

## 1. 项目概述

### 1.1 项目背景
本项目旨在开发一个自动化工具，用于在腾讯分分彩应用中执行公式搜索操作，提取搜索结果，并与最新开奖数据进行对比分析，以验证公式的准确性和有效性。

### 1.2 项目目标
- 实现桌面应用的自动化操作流程
- 自动执行公式搜索并提取结果数据
- 与最新开奖数据进行对比分析
- 支持循环执行搜索和对比操作

### 1.3 项目范围
本项目聚焦于自动化操作和数据处理，包括应用启动、界面导航、公式搜索、数据提取和结果对比等功能。

## 2. 功能需求

### 2.1 系统启动与导航
- 自动启动桌面应用程序（奇趣腾讯分分彩）
- 等待应用完全加载完成
- 自动识别并点击进入「腾讯分分彩」模块
- 自动识别并点击「公式搜索」功能入口
- 等待公式搜索界面完全加载

### 2.2 公式搜索设置
- 在搜索界面左侧配置以下搜索参数：
  - 搜索公式数量：100
  - 数据期数：200
  - 定码个数：5
  - 计划周期：1
  - 准确率(%)：≥57
  - 确保已选择「准确率(%)」筛选条件
  - 其他相关筛选条件保持默认设置

### 2.3 搜索执行与结果提取
- 自动点击「开始搜索」按钮
- 等待搜索结果加载完成
- 从右侧搜索结果表格中提取排名前5的数据记录
- 对每条记录的「当前推荐号」字段进行提取
- 将提取的号码字符串（如 "1 3 5 6 7"）转换为数字数组
- 对每个数组内的数字进行从小到大排序
- 生成排序后的号码列表

### 2.4 数据对比分析
- 从本地文件 `d:\PC-Test\docs\链接.md` 中解析获取API接口URL
- 构建API请求，设置适当的请求头
- 发送请求获取最新一期的开奖数据
- 解析开奖数据，提取最新开奖号码
- 将排序后的推荐号码与开奖号码进行对比
- 检查是否有至少一个号码命中
- 记录对比结果（命中/未命中）
- 无论对比结果如何，准备执行下一轮搜索

### 2.5 循环执行
- 自动点击「停止搜索」按钮（如果搜索仍在进行）
- 清除当前搜索结果
- 重新点击「开始搜索」按钮，开始新一轮搜索
- 重复执行搜索、提取、处理、对比的完整流程
- 支持无限循环模式
- 提供手动中断机制

## 3. 数据需求

### 3.1 数据来源
- **应用界面数据**：公式搜索界面的搜索结果表格数据
- **本地配置文件**：`d:\PC-Test\docs\链接.md`，包含API接口信息
- **在线API接口**：
  - 历史开奖数据接口：`https://kjapi.com/hall/hallhistory/txffcqiqu/ksffc`
  - 指定日期历史数据接口：`https://kjapi.com/hallhistoryDetail/txffcqiqu/[日期]`，其中[日期]格式为YYYY-MM-DD

### 3.2 数据格式

#### 3.2.1 搜索结果数据格式
- **表格结构**：
  - 已完成周期：整数
  - 准确率：百分比（如62.50%）
  - 剩余期数：整数
  - 最大连对：整数
  - 当前连对：整数
  - 最大连错：整数
  - 当前连错：整数
  - 当前推荐号：空格分隔的数字字符串（如 "1 3 5 6 7"）

#### 3.2.2 推荐号码格式
- 格式：空格分隔的数字字符串
- 示例："1 3 5 6 7"
- 范围：0-9的数字
- 数量：每个推荐包含5个不重复数字

#### 3.2.3 开奖数据格式（API返回）
```json
{
  "code": 0,
  "data": [
    {
      "period": "20251122113", // 期号
      "number": "8,0,6,4,4",   // 开奖号码，逗号分隔
      "time": "2025-11-22 18:33:00" // 开奖时间
    }
    // 更多历史记录...
  ],
  "message": "success"
}
```

### 3.3 数据处理逻辑

#### 3.3.1 搜索结果处理流程
1. **数据提取**：
   - 从搜索结果表格中提取前5条记录
   - 对每条记录提取「当前推荐号」字段
2. **数据清洗**：
   - 移除推荐号字符串中的多余空格
   - 验证格式是否正确（5个数字，空格分隔）
3. **数据转换**：
   - 将字符串（如 "1 3 5 6 7"）按空格分割成字符串数组
   - 将字符串数组转换为整数数组
4. **数据排序**：
   - 对每个整数数组按升序排序
   - 排序后的结果示例：[1, 3, 5, 6, 7]

#### 3.3.2 开奖数据处理流程
1. **API请求构建**：
   - 从本地文件解析获取API接口URL
   - 设置请求头：User-Agent, Referer等
   - 添加1-2秒延迟避免频率限制
2. **数据获取**：
   - 发送GET请求到历史开奖数据接口
   - 检查响应状态码，处理错误情况
3. **数据解析**：
   - 解析JSON响应
   - 提取最新一期的开奖数据（数组第一个元素）
   - 从开奖号码字符串（如 "8,0,6,4,4"）中提取数字
   - 将开奖号码处理为整数数组

#### 3.3.3 数据对比逻辑
1. **集合操作**：
   - 将排序后的推荐号码数组转换为集合
   - 将开奖号码数组转换为集合
2. **交集计算**：
   - 计算两个集合的交集
   - 检查交集是否非空（至少有一个共同元素）
3. **结果判断**：
   - 如果交集非空，判定为「命中」
   - 如果交集为空，判定为「未命中」
4. **结果记录**：
   - 记录对比结果及相关数据
   - 为下一轮循环做准备

## 4. 非功能需求

### 4.1 性能要求
- 搜索操作响应时间：≤5秒
- 数据处理时间：≤1秒
- 支持长时间稳定运行

### 4.2 可靠性要求
- 具备错误处理和重试机制
- 网络请求失败时能够优雅处理
- 应用界面变化时具备一定的容错能力

### 4.3 安全性要求
- 遵守API接口的使用限制和频率控制
- 保护用户数据和隐私

## 5. 实现注意事项

### 5.1 API调用限制
- 添加请求延迟（1-2秒），严格遵守接口频率限制，避免IP被封禁
- 设置适当的User-Agent、Referer等请求头，模拟真实浏览器行为
- 实现指数退避重试机制，在请求失败时进行有限次数的重试

### 5.2 错误处理
- 全面处理各类异常情况：
  - 网络错误（连接超时、断开连接等）
  - API返回错误（状态码异常、错误响应等）
  - JSON解析错误
  - 应用界面元素未找到或结构变化
- 实现健壮的数据校验机制，确保采集的数据完整性和正确性
- 记录详细日志，便于问题排查和系统监控

### 5.3 界面自动化策略
- 使用适当的等待策略（显式等待、隐式等待结合），避免因界面加载未完成导致操作失败
- 实现元素定位的容错机制，当主定位方式失败时尝试备用定位方式
- 对界面操作添加重试逻辑，提高自动化的稳定性

### 5.4 维护与扩展
- 采用模块化设计，将界面操作、数据处理、API调用等功能分离
- 使用配置文件管理可变参数，如搜索参数、API地址等，便于调整
- 代码结构清晰，添加必要注释，便于后续维护和功能扩展

## 6. 验收标准

### 6.1 功能验收
- 自动化工具能够成功启动「奇趣腾讯分分彩」应用
- 正确导航至腾讯分分彩模块和公式搜索界面
- 准确配置搜索参数（搜索公式数量100、数据期数200、定码个数5等）
- 成功执行搜索并提取前5条推荐号码
- 正确对推荐号码进行排序处理
- 从本地文件获取API信息并成功调用获取最新开奖数据
- 准确对比推荐号码与开奖号码，判断是否命中
- 成功循环执行整个流程至少10次

### 6.2 性能验收
- 单次完整流程执行时间不超过30秒
- 系统能够稳定运行至少24小时无错误
- 资源占用合理，CPU使用率峰值不超过50%

### 6.3 稳定性验收
- 在网络波动情况下能够自动重试并恢复
- 当应用界面响应缓慢时能够适当延长等待时间
- 异常情况下能够记录错误信息并继续执行

## 7. 实施建议

### 7.1 技术选型
- 界面自动化：建议使用PyAutoGUI或Pywinauto（针对Windows桌面应用）
- 网络请求：使用Requests库处理API调用
- 数据处理：使用Python标准库进行数据解析和处理
- 日志记录：使用Python logging模块实现详细日志

### 7.2 开发计划
1. **阶段一**：环境搭建和基础功能开发
   - 开发应用启动和导航功能
   - 实现搜索参数设置功能

2. **阶段二**：核心功能开发
   - 实现搜索结果提取和处理
   - 开发API调用和数据获取功能
   - 实现数据对比逻辑

3. **阶段三**：循环机制和错误处理
   - 实现循环执行逻辑
   - 完善异常处理机制
   - 添加日志记录功能

4. **阶段四**：测试和优化
   - 进行系统测试和bug修复
   - 性能优化
   - 文档完善

### 7.3 风险提示
- 应用界面可能会更新，导致自动化脚本失效
- API接口可能会变更或限制访问
- 频繁的自动化操作可能会触发应用的反爬虫机制

## 8. 附录

### 8.1 相关术语解释
- **腾讯分分彩**：一种彩票游戏类型
- **公式搜索**：根据设定的条件搜索预测公式的功能
- **定码**：确定要预测的数字个数
- **准确率**：公式预测成功的概率
- **连对/连错**：连续预测成功/失败的次数
