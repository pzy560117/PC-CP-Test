# 腾讯分分彩公式搜索自动化工具 - 待办清单

## 核心开发原则

### 技术栈统一性
- [ ] 使用Python 3.8+作为核心编程语言
- [ ] 使用PyAutoGUI或Pywinauto进行Windows桌面应用自动化
- [ ] 使用Requests库处理API调用，确保请求安全可靠
- [ ] 使用Python标准库（json, re, datetime等）进行数据解析和处理

### 代码规范与结构
- [ ] 类名使用大驼峰命名法（如 `AppAutomator`）
- [ ] 函数/方法使用小驼峰命名法（如 `clickButton`）
- [ ] 变量使用小驼峰命名法，保持语义化
- [ ] 常量使用全大写加下划线（如 `SEARCH_TIMEOUT`）
- [ ] 采用模块化设计，功能分离，单一职责原则
- [ ] 为类、方法和关键逻辑添加详细注释
- [ ] 使用try-except结构捕获和处理异常

### 日志与调试规范
- [ ] 使用Python logging模块，配置DEBUG级别
- [ ] 记录关键操作、错误信息、执行时间等
- [ ] 实现日志文件滚动，保留一定时间的历史日志
- [ ] 关键操作和结果同时输出到控制台，便于观察

### 可靠性与稳定性
- [ ] 使用显式等待和隐式等待结合，避免硬编码等待时间
- [ ] 实现指数退避重试，特别是网络请求和界面操作
- [ ] 当界面元素未找到时，尝试备用定位方法或适当容错
- [ ] 定义自定义异常类，统一处理各类异常情况

---

## 迭代 1：项目基础环境搭建 (预计1天)

### 项目初始化与基础架构

#### 项目结构创建
- [ ] 创建项目根目录和子目录：
  - `txffc-automation/` (根目录)
  - `src/` (源代码目录)
    - `automation/` (自动化模块)
    - `api/` (API调用模块)
    - `data/` (数据处理模块)
    - `config/` (配置管理模块)
    - `utils/` (工具类模块)
    - `exception/` (异常类模块)
  - `tests/` (测试目录)
  - `logs/` (日志目录)
  - `config/` (配置文件目录)
  - `requirements.txt` (依赖文件)
  - `main.py` (主程序入口)
  - `README.md` (项目说明)
- [ ] 在`requirements.txt`中添加核心依赖：
  - pyautogui
  - pywinauto
  - requests
  - opencv-python (用于图像识别，可选)
  - numpy (用于数据处理，可选)
- [ ] 创建`main.py`作为程序入口
  - 设置基本的程序启动逻辑
  - 添加命令行参数解析（可选）

#### 配置管理模块开发
- [ ] 在`src/config/`目录下创建`ConfigLoader.py`
  - 实现从JSON或YAML文件加载配置
  - 支持配置缓存和更新
- [ ] 在`config/`目录下创建`config.json`
  - 设置搜索参数配置：
    - 搜索公式数量：100
    - 数据期数：200
    - 定码个数：5
    - 计划周期：1
    - 准确率要求：57
  - 设置API相关配置：
    - API地址模板
    - 请求头设置
    - 重试次数和延迟

#### 日志系统配置
- [ ] 在`src/config/`目录下创建`LogConfig.py`
  - 配置Python logging模块
  - 设置控制台和文件双重输出
  - 配置日志级别和格式
- [ ] 实现日志滚动策略
  - 配置日志文件按大小和日期滚动
  - 设置日志文件保留时间（如7天）
  - 配置日志文件命名规则
- [ ] 在`src/utils/`目录下创建`Logger.py`
  - 提供统一的日志记录接口
  - 支持不同模块使用不同的日志器

#### 异常处理模块开发
- [ ] 在`src/exception/`目录下创建异常类：
  - `AutomationException` (基础异常类)
  - `InterfaceNotFoundException` (界面元素未找到异常)
  - `APICallException` (API调用异常)
  - `DataProcessException` (数据处理异常)
  - `ConfigException` (配置异常)
- [ ] 在`src/utils/`目录下创建`ExceptionHandler.py`
  - 实现全局异常捕获和处理
  - 提供异常信息格式化和日志记录

#### 项目初始化验证
- [ ] 编写基础测试脚本
  - 创建简单的测试脚本来验证项目结构
  - 测试配置加载功能
  - 测试日志记录功能
- [ ] 生成项目文档
  - 更新`README.md`文件
  - 添加项目简介、安装说明、使用方法等

---

## 迭代 2：界面自动化和搜索功能实现 (预计2天)

### 应用启动和导航自动化

#### 应用启动模块开发
- [ ] 在`src/automation/`目录下创建`AppLauncher.py`
  - 实现自动启动「奇趣腾讯分分彩」应用的功能
  - 支持从配置文件读取应用路径
  - 检测应用是否已启动
  - 等待应用完全加载
  - 添加错误处理和超时机制
- [ ] 实现应用状态检测功能
  - 检测应用窗口是否存在
  - 检测应用是否响应
  - 处理应用启动失败的情况

#### 界面导航模块开发
- [ ] 在`src/automation/`目录下创建`Navigator.py`
  - 实现导航到「腾讯分分彩」模块的功能
  - 定位并点击模块入口
  - 等待模块页面加载完成
  - 实现导航到「公式搜索」功能的路径
  - 定位并点击公式搜索入口
  - 等待公式搜索界面加载完成
- [ ] 实现元素定位策略
  - 基于坐标的定位
  - 基于图像识别的定位（可选）
  - 基于OCR的文本识别定位（可选）
  - 实现定位失败后的备用策略

#### 界面操作基类开发
- [ ] 在`src/automation/`目录下创建`BaseAutomator.py`
  - 实现基础的界面操作方法：
    - 点击操作
    - 输入文本
    - 等待元素出现
    - 滚动操作
  - 添加操作前的安全检查
- [ ] 实现等待策略
  - 显式等待（针对特定条件）
  - 隐式等待（全局默认等待）
  - 自适应等待（根据界面响应调整等待时间）
  - 处理等待超时的情况

### 搜索参数设置和执行

#### 搜索参数设置模块开发
- [ ] 在`src/automation/`目录下创建`SearchConfigurer.py`
  - 实现搜索参数设置功能：
    - 搜索公式数量：100
    - 数据期数：200
    - 定码个数：5
    - 计划周期：1
    - 准确率(%)：≥57
  - 确保已选择「准确率(%)」筛选条件
  - 从配置文件读取参数值
- [ ] 实现参数验证功能
  - 验证设置的值是否正确应用到界面
  - 处理参数设置失败的情况

#### 搜索执行模块开发
- [ ] 在`src/automation/`目录下创建`SearchExecutor.py`
  - 实现搜索操作功能：
    - 点击「开始搜索」按钮
    - 等待搜索结果加载完成
    - 点击「停止搜索」按钮
    - 清除搜索结果
  - 添加搜索状态监控
- [ ] 实现结果加载检测功能
  - 检测搜索结果表格是否加载完成
  - 处理搜索结果加载失败的情况

#### 测试和验证
- [ ] 编写自动化流程测试
  - 创建测试脚本，整合所有自动化功能
  - 测试完整流程：启动应用 -> 导航到公式搜索界面 -> 设置搜索参数 -> 执行搜索
  - 验证每个步骤的正确性
- [ ] 性能优化和稳定性测试
  - 分析自动化操作的性能瓶颈
  - 优化等待时间和操作顺序
  - 进行稳定性测试，验证多次执行的一致性

---

## 迭代 3：数据处理和API调用功能实现 (预计2天)

### 搜索结果提取和处理

#### 结果提取模块开发
- [ ] 在`src/automation/`目录下创建`ResultExtractor.py`
  - 实现从搜索结果表格提取数据的功能
  - 定位搜索结果表格
  - 提取排名前5的数据记录
  - 对每条记录提取「当前推荐号」字段
  - 处理表格结构变化的情况
- [ ] 实现数据提取验证功能
  - 验证提取的数据格式是否正确
  - 处理提取失败的情况

#### 数据处理模块开发
- [ ] 在`src/data/`目录下创建`DataProcessor.py`
  - 实现推荐号码数据处理功能
  - 将号码字符串（如 "1 3 5 6 7"）转换为数字数组
  - 对数组内的数字进行从小到大排序
  - 生成排序后的号码列表
  - 添加数据清洗和验证
- [ ] 实现数据验证和清洗功能
  - 验证号码格式是否正确
  - 检查号码是否在有效范围内（0-9）
  - 处理异常数据格式
  - 实现数据清洗功能：移除多余空格，处理特殊字符

### API调用和数据对比

#### API调用模块开发
- [ ] 在`src/api/`目录下创建`ApiCaller.py`
  - 实现从本地文件解析API信息的功能
  - 读取`d:\PC-Test\docs\链接.md`文件
  - 解析获取API接口URL
  - 实现API请求功能
  - 构建请求头和参数
  - 添加请求延迟（1-2秒）
  - 处理HTTP响应
- [ ] 实现请求重试机制
  - 定义最大重试次数（如3次）
  - 实现重试间隔递增逻辑
  - 处理不同类型的HTTP错误
  - 添加请求超时设置

#### 开奖数据处理模块开发
- [ ] 在`src/data/`目录下创建`LotteryDataProcessor.py`
  - 实现开奖数据解析功能
  - 解析API返回的JSON数据
  - 提取最新一期的开奖数据
  - 从开奖号码字符串提取数字
  - 将开奖号码处理为整数数组
  - 处理不同的返回格式和错误情况
- [ ] 实现开奖数据缓存功能
  - 缓存最新获取的开奖数据
  - 设置缓存过期时间
  - 在缓存有效时避免重复API调用

#### 数据对比分析模块开发
- [ ] 在`src/data/`目录下创建`DataComparator.py`
  - 实现推荐号码与开奖号码的对比功能
  - 计算两个号码集合的交集
  - 检查是否有至少一个号码命中
  - 生成对比结果（命中/未命中）
  - 记录对比的详细信息
- [ ] 实现对比结果记录功能
  - 记录对比时间、推荐号码、开奖号码、对比结果
  - 提供结果统计功能
  - 可选：将结果保存到本地文件

#### 集成测试
- [ ] 编写数据流程测试
  - 创建测试脚本，整合所有数据处理功能
  - 测试完整数据流程：提取推荐号码 -> 数据处理 -> API调用获取开奖数据 -> 数据对比
  - 验证每个步骤的正确性
  - 使用模拟数据进行测试
- [ ] 性能测试和优化
  - 分析数据处理的性能瓶颈
  - 优化数据解析和转换逻辑
  - 测试API调用的响应时间和成功率

---

## 迭代 4：循环执行、错误处理和优化测试 (预计2天)

### 循环执行和主程序整合

#### 循环执行模块开发
- [ ] 在`src/automation/`目录下创建`LoopExecutor.py`
  - 实现循环执行搜索和对比的功能
  - 配置循环次数或无限循环
  - 控制循环间隔时间
  - 实现循环状态监控
  - 提供手动中断机制
- [ ] 实现资源管理功能
  - 定期清理缓存和临时数据
  - 监控系统资源使用情况
  - 长时间运行时进行适当的资源释放

#### 主程序整合
- [ ] 更新`main.py`文件
  - 整合所有模块，实现完整的执行流程
  - 初始化配置和日志
  - 启动应用并导航
  - 设置搜索参数并执行搜索
  - 提取和处理推荐号码
  - 获取开奖数据并对比
  - 循环执行以上过程
  - 添加程序退出处理
- [ ] 添加用户界面（可选）
  - 创建简单的命令行界面或图形界面
  - 提供参数设置和执行控制功能
  - 显示执行状态和结果

### 错误处理优化和系统测试

#### 全局错误处理优化
- [ ] 更新异常处理机制
  - 实现更细粒度的异常捕获和处理
  - 为不同类型的异常提供针对性的恢复策略
  - 优化错误日志记录
- [ ] 实现故障自动恢复功能
  - 检测应用是否崩溃或无响应
  - 在必要时重启应用
  - 恢复到正常工作状态

#### 性能优化
- [ ] 识别性能瓶颈
  - 使用性能分析工具识别瓶颈
  - 重点分析以下方面：
    - 界面操作等待时间
    - API调用响应时间
    - 数据处理效率
- [ ] 实施性能优化
  - 优化关键性能瓶颈
  - 优化等待策略，减少不必要的等待时间
  - 优化API调用，提高请求效率
  - 优化数据结构和算法
  - 重构低效代码

#### 系统测试
- [ ] 编写单元测试
  - 为关键模块编写单元测试
  - 测试数据处理功能
  - 测试API调用功能
  - 测试数据对比功能
  - 使用模拟对象隔离依赖
- [ ] 进行集成测试
  - 测试完整的系统集成
  - 测试各模块协同工作
  - 测试边界条件和异常场景
  - 测试长时间运行稳定性
- [ ] 进行验收测试
  - 根据PRD文档进行验收测试
  - 验证所有功能需求是否满足
  - 验证性能要求是否达到
  - 验证可靠性要求是否满足
  - 记录测试结果和问题

---

## 交付标准

### 迭代 1 交付标准
- [ ] 项目目录结构完整，符合Python最佳实践
- [ ] 所有基础模块（配置、日志、异常）功能正常
- [ ] 程序可以正常启动，显示基本信息
- [ ] 日志系统工作正常，能记录不同级别的日志
- [ ] 异常处理机制完善，能捕获和处理各类异常
- [ ] README文档完整，包含必要的项目信息

### 迭代 2 交付标准
- [ ] 能成功启动「奇趣腾讯分分彩」应用
- [ ] 能正确导航到公式搜索界面
- [ ] 能准确设置所有搜索参数
- [ ] 能成功执行搜索操作并等待结果加载
- [ ] 能正确停止搜索并清除结果
- [ ] 所有自动化操作稳定可靠，具有良好的错误处理
- [ ] 完整流程测试通过，执行时间在合理范围内

### 迭代 3 交付标准
- [ ] 能正确从搜索结果提取前5条推荐号码
- [ ] 能对推荐号码进行正确的转换和排序
- [ ] 能从本地文件获取API信息并成功调用获取开奖数据
- [ ] 能正确解析开奖数据，提取最新开奖号码
- [ ] 能准确对比推荐号码与开奖号码，判断是否命中
- [ ] 数据处理和API调用稳定可靠，具有重试和错误处理机制
- [ ] 完整数据流程测试通过，结果准确无误

### 迭代 4 交付标准
- [ ] 系统能正确执行循环搜索和对比操作
- [ ] 具备完善的错误处理和自动恢复机制
- [ ] 长时间运行稳定，资源使用合理
- [ ] 性能优化后，单次完整流程执行时间不超过30秒
- [ ] 所有测试通过，系统符合PRD要求
- [ ] 代码质量高，文档完善
- [ ] 系统可以正常交付使用